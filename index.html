<html>
  <head>
    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
  </head>
  <body>
    <b>MediLink</b><br/>
    You can ask a question here!<br/>
    Someone will try to assist you <br/>
    
    <b>Enter your question here</b> <br/>
    <input type='text' id='caseid' placeholder='Case'>
    <input type='text' id='nameInput' placeholder='Name'>
    <input type='text' id='messageInput' placeholder='Message'>
    <button onclick="myFunction()">Ask here</button>
    <div id='messagesDiv'></div>
    
    <b>Assist someone here</b><br/>
    <input type='text' id='caseidA' placeholder='Case'>
    <input type='text' id='nameInputA' placeholder='Name'>
    <input type='text' id='messageInputA' placeholder='Message'>
    <button onclick="myHelp()">Answer Here</button><br/>
    
    <button onclick="window.location='http://ycchua.github.io/is429/history.html';">View History</button>
    
    <script>
      var myDataRef = new Firebase('https://ycchua.firebaseio.com/');
      myDataRef.on('child_added', function(snapshot) {
        var message = snapshot.val();
        displayChatMessage(message.name, message.text, message.caseid);
      });
      function displayChatMessage(name, text, caseid) {
        $('#messagesDiv').append("<div id='div_" + caseid + "' />");
        var container = $("#div_" + caseid);
        
        container.append("Case : <label>" + caseid + "</label><br/>")
        $('<div style="display:inline"/>').text(text).prepend($('<em/>').text(name+': ')).appendTo(container);
         container.append("<button onclick='removeElem(this)'>Resolved</button><br/>");
        $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
      };
      
      function myFunction()
      {
          var caseid = $('#caseid').val();
          var name = $('#nameInput').val();
          var text = $("#messageInput").val();
          myDataRef.push({caseid: caseid, name: name, text: text});
         // $('#messageInput').val('');
      }

      function removeElem(elem) {
        var history =  $(elem).parent().text();
        $(elem).parent().remove();
        myDataRef.remove();
        var myDataRef1 =  new Firebase('https://ycchuahistory.firebaseio.com');
        myDataRef1.push({history: history});
      }

      function myHelp()
      {
          var caseidA = $('#caseidA').val();
          var nameA = "HELPER"+$('#nameInputA').val();
          var textA = $("#messageInputA").val();
          myDataRef.push({caseid: caseidA, name: nameA, text: textA});
          $('#messageInput').val('');
      }


    </script>

  </body>
</html>
